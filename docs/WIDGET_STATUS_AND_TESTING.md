# Website Widget - Status & Testing Guide

**Date:** 2025-11-21  
**Last Updated:** 2025-11-21  
**Status:** âœ… Phase 1 & Phase 2 Complete | âœ… Phase 2+ (Theme Settings) Complete | ğŸ§ª Ready for End-to-End Testing

---

## ğŸ“Š **Current Status Overview**

### âœ… **Phase 1: Core Widget Settings - COMPLETE & IN PRODUCTION**

**Implemented Features:**
- âœ… Widget configuration display
- âœ… Widget key display (masked for security)
- âœ… Copy widget key functionality
- âœ… Rotate widget key functionality
- âœ… Embed snippet display
- âœ… Copy embed snippet functionality
- âœ… Usage statistics (last used, total requests)
- âœ… Widget enabled/disabled status display

**Deployment Status:**
- âœ… Deployed to `preview` branch
- âœ… Deployed to `main` branch (production)
- âœ… All features working

---

### âœ… **Phase 2: Enabled Toggle - COMPLETE & IN PRODUCTION**

**Implemented Features:**
- âœ… Enable/disable widget toggle button
- âœ… Real-time status updates
- âœ… Toast notifications for status changes
- âœ… Optimistic UI updates
- âœ… Error handling and rollback

**Deployment Status:**
- âœ… Deployed to `preview` branch
- âœ… Deployed to `main` branch (production)
- âœ… All features working

---

### âœ… **Phase 2+: Theme Customization - COMPLETE & IN PREVIEW**

**Implemented Features:**
- âœ… Primary color picker (HTML5 color input + hex text input)
- âœ… Accent color picker (HTML5 color input + hex text input)
- âœ… Widget title input (50 character limit)
- âœ… Welcome message input (200 character limit)
- âœ… Widget position selector (bottom-right, bottom-left)
- âœ… Debounced auto-save (500ms)
- âœ… Loading indicators during save
- âœ… Success/error toast notifications
- âœ… Auto-reload embed snippet after save
- âœ… Tooltips with help text for each field

**Deployment Status:**
- âœ… Deployed to `preview` branch
- â¸ï¸ **Pending deployment to `main` branch** (awaiting testing)

---

## ğŸ¯ **What's Done vs What's Pending**

### âœ… **COMPLETE (In Production)**
1. **Widget Configuration Display**
   - View widget key (masked)
   - View usage statistics
   - View embed snippet

2. **Widget Key Management**
   - Copy widget key
   - Rotate widget key
   - Key rotation confirmation

3. **Widget Status Control**
   - Enable/disable widget toggle
   - Real-time status updates

4. **Embed Snippet**
   - Display embed snippet
   - Copy embed snippet
   - Instructions for embedding

### âœ… **COMPLETE (In Preview - Phase 2+)**
5. **Theme Customization**
   - Primary color picker
   - Accent color picker
   - Widget title
   - Welcome message
   - Widget position
   - Auto-save with debouncing

### â¸ï¸ **PENDING (Future Enhancements)**
- â¸ï¸ Allowed domains management (backend feature)
- â¸ï¸ Widget preview (live preview of theme changes)
- â¸ï¸ Advanced theme options (fonts, sizes, etc.)
- â¸ï¸ Widget analytics dashboard
- â¸ï¸ Multi-widget support

---

## ğŸ§ª **Will the Widget Work on a Website Now?**

### **YES - If Widget is Enabled**

**Requirements for Widget to Work:**
1. âœ… Widget must be **enabled** in settings (`/admin/settings`)
2. âœ… Widget key must be valid (generated by backend)
3. âœ… Embed snippet must be copied and pasted into website HTML
4. âœ… Website domain must be in allowed domains list (if backend enforces this)

**Current Status:**
- âœ… **Widget settings UI is complete** - You can enable/disable, configure theme, copy embed snippet
- âœ… **Backend API endpoints exist** - `/api/admin/widget/config`, `/api/admin/widget/rotate-key`, `/api/admin/tenant-settings`
- âš ï¸ **Widget runtime/embed script** - This is handled by the backend/widget service (not part of Admin UI)

**What the Admin UI Provides:**
- Configuration interface
- Widget key management
- Theme customization
- Embed snippet generation

**What the Backend/Widget Service Provides:**
- Widget JavaScript runtime
- Widget API endpoints
- Domain validation
- Widget rendering

---

## ğŸ§ª **How to Test End-to-End**

### **Step 1: Access Widget Settings**

1. Navigate to `/admin/settings` in your Admin UI
2. Scroll to "Website Widget" section
3. Verify you can see:
   - Widget Status (Enabled/Disabled)
   - Widget Key (masked)
   - Usage statistics (if available)
   - Embed Snippet

### **Step 2: Enable Widget**

1. Click the "Enabled" or "Disabled" button
2. Wait for toast notification confirming status change
3. Verify button text updates to reflect new status
4. **Note:** Widget must be enabled for it to work on websites

### **Step 3: Configure Theme (Optional - Phase 2+)**

1. Scroll to "Theme Customization" section
2. Test each setting:
   - **Primary Color:** Click color picker or enter hex code (e.g., `#3b82f6`)
   - **Accent Color:** Click color picker or enter hex code (e.g., `#8b5cf6`)
   - **Widget Title:** Enter text (e.g., "Chat with us")
   - **Welcome Message:** Enter text (e.g., "Hi! How can I help you today?")
   - **Widget Position:** Select "Bottom Right" or "Bottom Left"
3. Wait for auto-save (500ms debounce)
4. Verify loading spinner appears during save
5. Verify toast notification appears on success
6. Verify embed snippet updates automatically

### **Step 4: Copy Embed Snippet**

1. Scroll to "Embed Snippet" section
2. Click "Copy Snippet" button
3. Verify button shows "Copied" with checkmark for 2 seconds
4. Verify snippet is copied to clipboard

### **Step 5: Test Widget Key Rotation**

1. Click "Rotate Key" button
2. Confirm the rotation in the dialog
3. Verify new key is generated
4. Verify embed snippet updates with new key
5. **Important:** Old key will stop working immediately

### **Step 6: Embed on Test Website**

1. Create a simple HTML test page:
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Test Page</title>
</head>
<body>
    <h1>Widget Test Page</h1>
    <p>This is a test page to verify the widget works.</p>
    
    <!-- Paste the embed snippet here (before </body>) -->
    <!-- Example: -->
    <!-- <script src="https://widget.example.com/embed.js?key=YOUR_WIDGET_KEY"></script> -->
</body>
</html>
```

2. Copy the embed snippet from Admin UI
3. Paste it before `</body>` tag in your test HTML
4. Save the HTML file
5. Open it in a web browser (or serve via local server)

### **Step 7: Verify Widget Appears**

1. Open your test HTML page in a browser
2. Verify widget appears in the configured position (bottom-right or bottom-left)
3. Verify widget shows configured title (if set)
4. Verify widget shows welcome message (if set)
5. Verify widget colors match configured theme
6. Click on widget to open chat interface
7. Test asking a question
8. Verify widget responds (connects to backend)

### **Step 8: Test Widget Disabled State**

1. Go back to Admin UI `/admin/settings`
2. Click "Disabled" button to disable widget
3. Refresh your test HTML page
4. Verify widget does NOT appear (or shows disabled message)
5. Re-enable widget
6. Refresh test page
7. Verify widget appears again

### **Step 9: Test Theme Changes**

1. In Admin UI, change theme settings (colors, title, message, position)
2. Wait for auto-save to complete
3. Refresh your test HTML page
4. Verify widget reflects new theme settings
5. **Note:** You may need to clear browser cache if widget script is cached

---

## ğŸ” **Troubleshooting**

### **Widget Not Appearing**

**Check:**
1. âœ… Widget is enabled in Admin UI
2. âœ… Embed snippet is correctly pasted in HTML
3. âœ… Widget key is valid (not rotated/deleted)
4. âœ… Website domain is in allowed domains list (if backend enforces)
5. âœ… Browser console for JavaScript errors
6. âœ… Network tab for failed script loads

### **Theme Changes Not Reflecting**

**Check:**
1. âœ… Theme settings saved successfully (check toast notification)
2. âœ… Embed snippet updated (check if snippet includes theme attributes)
3. âœ… Browser cache cleared
4. âœ… Widget script supports theme attributes (backend feature)

### **Widget Key Rotation Issues**

**Check:**
1. âœ… New key generated successfully
2. âœ… Embed snippet updated with new key
3. âœ… Old embed snippet replaced on website
4. âœ… Old key stopped working (expected behavior)

---

## ğŸ“ **API Endpoints Used**

### **GET /api/admin/widget/config**
- Fetches widget configuration
- Returns: `WidgetConfig` with key, settings, usage stats, embed snippet

### **POST /api/admin/widget/rotate-key**
- Rotates widget key
- Returns: New key and updated embed snippet

### **POST /api/admin/tenant-settings**
- Updates widget settings (enabled, theme)
- Body: `{ updates: [{ key: 'WIDGET.ENABLED', value: { value: 1 } }] }`

---

## âœ… **Testing Checklist**

### **Phase 1 & 2 (In Production)**
- [x] View widget configuration
- [x] Copy widget key
- [x] Rotate widget key
- [x] Copy embed snippet
- [x] Enable/disable widget
- [x] View usage statistics

### **Phase 2+ (In Preview)**
- [x] Configure primary color
- [x] Configure accent color
- [x] Set widget title
- [x] Set welcome message
- [x] Change widget position
- [x] Auto-save functionality
- [x] Embed snippet updates

### **End-to-End Testing**
- [ ] Embed widget on test website
- [ ] Verify widget appears
- [ ] Verify widget theme matches settings
- [ ] Test widget chat functionality
- [ ] Test widget disabled state
- [ ] Test theme changes reflect on website

---

## ğŸš€ **Next Steps**

1. **Test Phase 2+ in Preview**
   - Verify all theme settings work
   - Test embed snippet updates
   - Verify auto-save functionality

2. **End-to-End Testing**
   - Create test HTML page
   - Embed widget snippet
   - Verify widget appears and works
   - Test all theme customizations

3. **Deploy Phase 2+ to Production**
   - After successful testing in preview
   - Deploy theme customization to `main` branch

4. **Future Enhancements**
   - Allowed domains management UI
   - Widget preview feature
   - Advanced theme options

---

**Status:** âœ… **Phase 1 & 2 Complete & In Production** | âœ… **Phase 2+ Complete & In Preview** | ğŸ§ª **Ready for End-to-End Testing**




